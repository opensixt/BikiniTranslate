{% extends 'OpensixtBikiniTranslateBundle::base.html.twig' %}

{% block title %}
    {{ 'translation_tool'|trans }}
{% endblock %}

{% block body %}

    <h3>{{ 'translation_tool'|trans }}</h3>

    <div class="textblock alert alert-info"><button class="close">&times;</button>{{ 'searchstring_explanation'|trans }}</div>

    <form action="{{ path('_translate_searchstring') }}" method="post" {{ form_enctype(form) }}>

        {{ form_label(form.search) }} {{ form_widget(form.search) }}
        {{ form_label(form.resource) }} {{ form_widget(form.resource) }}
        {{ form_label(form.mode) }} {{ form_widget(form.mode) }}
        <br/>
        {{ form_label(form.locale) }} {{ form_widget(form.locale) }}
        <br/>
        <input type="submit" value="{{ 'submit_page'|trans }}"/>
        {{ form_rest(form) }}
    </form>

    {% if searchResults is defined %}
    <table class="table table-bordered table-striped">
        <thead>
            <tr>
                <th>{{ 'results'|trans }}</th>
            </tr>
        </thead>
        <tbody>

        {% for item in searchResults %}
            <tr>
                <td>
                    "{{ searchPhrase }}" ({{ item.resource.name }} - {{ item.locale.locale }}):
                    <div id="text_{{ item.id }}" class="textItems clickable inline">{{ item.target }}</div>
                </td>
            </tr>
        {% else %}
            <tr>
                <td colspan="2">{{ 'no_translation_found'|trans }}</td>
            </tr>
        {% endfor %}
        </tbody>
        <tfoot>
            <tr>
                <td colspan="2">
                    {# navigation #}
                    {{ searchResults.render()|raw }}
                </td>
            </tr>
        </tfoot>
    </table>
    {% endif %}

{% endblock %}

{% block javascripts %}
    <script type="text/javascript">
    jQuery(document).ready(function($) {
        // no conflict mode, use $ in here

        $('div.textItems').click(function() {
            var id = $(this).attr('id').replace('text_', '');

            var text = $(this).html();
            var isTextarea = text.search('<textarea');
            if (isTextarea == -1) {
                // TODO: replace 'save' with icon
                var textarea = '<textarea id="edit_' + id + '">' + text + '</textarea><a href="#" class="savetext">save</a>';
                $(this).html(textarea);
            }

        });

        $('a.savetext', 'table.list').live('click', function(event) {
            event.stopPropagation();
            event.preventDefault();

            var text = $(this).prev("textarea");
            $.post('{{ path('_translate_ajax_savetext') }}',
               {
                   'id': text.attr('id').replace('edit_', ''),
                   'text': text.val()
               },
               function(data) {
                   if (data.status === 0) {
                       text.parent().html(text.val());
                   }
               },
               'json'
           );
        });

    });

    </script>
{% endblock %}

